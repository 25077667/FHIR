{"version":3,"sources":["webpack:///./src/pages/guides/FHIRSearchConfiguration.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"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","file":"component---src-pages-guides-fhir-search-configuration-md-e1316a3abe08a50df49f.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/FHIR/FHIR/fhir/docs/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1>{`IBM FHIR Server - Search Configuration Overview`}</h1>\n    <p>{`The `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.hl7.org/fhir/r4/search.html\"\n      }}>{`FHIR Specification`}</a>{` defines a set of searchable fields for each resource type. The IBM FHIR Server supports searching via both specification-defined search parameters and tenant-specific search parameters.`}</p>\n    <p>{`Specifically, the IBM FHIR Server supports searching on additional fields, including:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`fields that are defined in the base specification, which are not configured for search; and`}</li>\n      <li parentName=\"ul\">{`extension elements that a tenant may add to a standard FHIR resource type`}</li>\n    </ul>\n    <p>{`The IBM FHIR Server allows deployers to define search parameters on a tenant-specific basis. This allows each tenant to share an instance of the FHIR server while maintaining the ability to have their own set of search parameters. Additionally, specification-defined search parameters can be filtered out in order to avoid the cost of extracting and storing the corresponding indices.`}</p>\n    <p>{`Tenant search parameters are defined via a `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.hl7.org/fhir/r4/bundle.html\"\n      }}>{`Bundle`}</a>{` of `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.hl7.org/fhir/r4/searchparameter.html\"\n      }}>{`SearchParameter`}</a>{` resources that define the additional search parameters which describe the searchable field and define the FHIRPath expression for extraction.  For example, a tenant that extends the `}<inlineCode parentName=\"p\">{`Patient`}</inlineCode>{` resource type with the `}<inlineCode parentName=\"p\">{`favorite-color`}</inlineCode>{` extension, enables search on `}<inlineCode parentName=\"p\">{`favorite-color`}</inlineCode>{` by defining a SearchParameter as part of this bundle.`}</p>\n    <h2>{`1 Configuration`}</h2>\n    <p>{`There are three layers of search parameter configuration.  `}</p>\n    <ul>\n      <li parentName=\"ul\">{`built-in parameters from the core specification and packaged implementation guides`}</li>\n      <li parentName=\"ul\">{`default tenant parameters`}</li>\n      <li parentName=\"ul\">{`tenant-specific parameters`}</li>\n    </ul>\n    <p>{`The built-in SearchParameters are loaded from the `}<inlineCode parentName=\"p\">{`fhir-registry`}</inlineCode>{` in the `}<inlineCode parentName=\"p\">{`fhir-search`}</inlineCode>{` module during server startup.`}</p>\n    <p>{`The default and tenant level configurations are put in the `}<inlineCode parentName=\"p\">{`default`}</inlineCode>{` and tenant-specific (e.g. `}<inlineCode parentName=\"p\">{`tenant1`}</inlineCode>{`) config folders respectively. These folders are populated with `}<inlineCode parentName=\"p\">{`extension-search-parameters.json`}</inlineCode>{`.`}</p>\n    <p>{`The IBM FHIR Server configuration prefers the JSON formatted configuration documents, and implements caching via `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/FHIR/blob/master/fhir-search/src/main/java/com/ibm/fhir/search/parameters/cache/TenantSpecificSearchParameterCache.java\"\n      }}>{`TenantSpecificSearchParameterCache.java`}</a>{`.`}</p>\n    <p>{`The IBM FHIR Server supports compartment searches based on the CompartmentDefinition resources found at `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM/FHIR/blob/master/fhir-search/src/main/resources/compartments.json\"\n      }}>{`fhir-search/src/main/resources/compartments.json`}</a>{`. These definitions come directly from the specification and the server provides no corresponding default or tenant-level configuration.`}</p>\n    <h3>{`1.1 Tenant-specific parameters`}</h3>\n    <p>{`To configure tenant-specific search parameters, create a file called `}<inlineCode parentName=\"p\">{`extension-search-parameters.json`}</inlineCode>{`, placing it in the `}<inlineCode parentName=\"p\">{`\\${server.config.dir}/config/<tenant-id>`}</inlineCode>{` directory. For example, the `}<inlineCode parentName=\"p\">{`\\${server.config.dir}/config/acme/extension-search-parameters.json`}</inlineCode>{` file would contain the search parameters for the `}<inlineCode parentName=\"p\">{`acme`}</inlineCode>{` tenant, while `}<inlineCode parentName=\"p\">{`\\${server.config.dir}/config/qpharma/extension-search-parameters.json`}</inlineCode>{` would contain search parameters used by the `}<inlineCode parentName=\"p\">{`qpharma`}</inlineCode>{` tenant.`}</p>\n    <p>{`When the FHIR server processes a request associated with the `}<inlineCode parentName=\"p\">{`acme`}</inlineCode>{` tenant, the server is uses the built-in search parameters and the user-defined search parameters defined in the `}<inlineCode parentName=\"p\">{`acme`}</inlineCode>{` tenant’s `}<inlineCode parentName=\"p\">{`extension-search-parameters.json`}</inlineCode>{` file. Likewise, when processing a request associated with the `}<inlineCode parentName=\"p\">{`qpharma`}</inlineCode>{` tenant, the server uses the built-in search parameters and the user-defined search parameters defined in the `}<inlineCode parentName=\"p\">{`qpharma`}</inlineCode>{` tenant’s `}<inlineCode parentName=\"p\">{`extension-search-parameters.json`}</inlineCode>{` file.`}</p>\n    <p>{`If a tenant-specific extension-search-parameters.json file does not exist, the server falls back to the global `}<inlineCode parentName=\"p\">{`extension-search-parameters.json`}</inlineCode>{` file found at `}<inlineCode parentName=\"p\">{`\\${server.config.dir}/config/default/extension-search-parameters.json`}</inlineCode>{`.`}</p>\n    <p>{`The FHIR server caches search parameters in memory (organized first by tenant id, then by resource type and search parameter). Any updates to a tenant’s `}<inlineCode parentName=\"p\">{`extension-search-parameters.json`}</inlineCode>{` file causes the FHIR server to re-load the tenant’s search parameters and refresh the information stored in the cache, without requiring a server re-start. This allows the deployer to deploy a new tenant’s `}<inlineCode parentName=\"p\">{`extension-search-parameters.json`}</inlineCode>{` or update an existing file without re-starting the FHIR server and any subsequent requests processed by the FHIR server after the updates have been made use the updated search parameters. However, it is important to note that this process `}<strong parentName=\"p\">{`does not`}</strong>{` re-index already-created resources that are stored on the FHIR Server. One technique for updating the indices for a given resource type is to `}<inlineCode parentName=\"p\">{`read`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`update`}</inlineCode>{` each resource instance with itself, triggering search parameter extraction (and creating a new version of each resource).`}</p>\n    <p>{`Starting in version 4.5.0, the IBM FHIR Server supports `}<a parentName=\"p\" {...{\n        \"href\": \"#2-re-index\"\n      }}>{`re-indexing resources`}</a>{` with an updated set of search parameters. This is very similar to creating a new version of the resources, except in this case the version number doesn’t change and the data for the resource never leaves the server.`}</p>\n    <h4>{`1.1.1 Search parameters configuration: extension-search-parameters.json`}</h4>\n    <p>{`To configure the FHIR server with one or more custom search parameters, create a file called `}<inlineCode parentName=\"p\">{`extension-search-parameters.json`}</inlineCode>{` and populate the contents with a Bundle of `}<inlineCode parentName=\"p\">{`SearchParameter`}</inlineCode>{` resources.`}</p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`fhir-search`}</inlineCode>{` module requires that the `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.hl7.org/fhir/r4/searchparameter-definitions.html#SearchParameter.expression\"\n      }}>{`expression`}</a>{`, `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.hl7.org/fhir/r4/searchparameter-definitions.html#SearchParameter.type\"\n      }}>{`type`}</a>{` and `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.hl7.org/fhir/r4/searchparameter-definitions.html#SearchParameter.code\"\n      }}>{`code`}</a>{` be set, as in the following example:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`{\n   \"resourceType\": \"Bundle\",\n   \"id\": \"searchParams\",\n   \"meta\": {\n      \"lastUpdated\": \"2019-07-12T22:37:54.724+11:00\"\n   },\n   \"type\": \"collection\",\n   \"entry\": [{\n      \"fullUrl\": \"http://ibm.com/fhir/SearchParameter/Patient-favorite-color\",\n      \"resource\": {\n         \"resourceType\": \"SearchParameter\",\n         \"id\": \"Patient-favorite-color\",\n         \"url\": \"http://ibm.com/fhir/SearchParameter/Patient-favorite-color\",\n         \"version\": \"4.0.0\",\n         \"name\": \"favorite-color\",\n         \"status\": \"draft\",\n         \"experimental\": false,\n         \"date\": \"2018-12-27T22:37:54+11:00\",\n         \"publisher\": \"IBM FHIR Server Test\",\n         \"contact\": [{\n            \"telecom\": [{\n               \"system\": \"url\",\n               \"value\": \"http://ibm.com/fhir\"\n            }]\n         },\n         {\n            \"telecom\": [{\n               \"system\": \"url\",\n               \"value\": \"http://ibm.com/fhir\"\n            }]\n         }],\n         \"description\": \"the patient's favorite color\",\n         \"code\": \"favorite-color\",\n         \"base\": [\"Patient\"],\n         \"type\": \"string\",\n         \"xpathUsage\": \"normal\",\n         \"xpath\": \"f:Patient/f:extension[@url='http://ibm.com/fhir/extension/Patient/favorite-color']/f:valueString\",\n         \"expression\": \"Patient.extension.where(url='http://ibm.com/fhir/extension/Patient/favorite-color').value\",\n         \"multipleOr\": true,\n         \"multipleAnd\": true,\n         \"modifier\": []\n      }\n   }\n}\n`}</code></pre>\n    <p>{`A few things to note are:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`This SearchParameter includes an xpath element for completeness, but the IBM FHIR Server does not use the XPath during extraction; it only uses the expression (FHIRPath).`}</li>\n      <li parentName=\"ul\">{`The SearchParameter with a path including `}<inlineCode parentName=\"li\">{`value`}</inlineCode>{` use the Choice data types which are determined based on the SearchParameter type .`}</li>\n      <li parentName=\"ul\">{`Each time a resource is created or updated, the FHIR server evaluates the FHIRPath expression applicable to the resource type and indexes the values of the matching elements, making these available via a search where the query parameter name matches the `}<inlineCode parentName=\"li\">{`code`}</inlineCode>{` element on the `}<inlineCode parentName=\"li\">{`SearchParameter`}</inlineCode>{` definition.`}</li>\n    </ul>\n    <p>{`In the preceding example, extension elements (on a Patient resource) with a url of `}<inlineCode parentName=\"p\">{`http://ibm.com/fhir/extension/Patient/favorite-color`}</inlineCode>{` are indexed by the `}<inlineCode parentName=\"p\">{`favorite-color`}</inlineCode>{` search parameter. To search for Patients with a favorite color of “pink”, users could send an HTTP GET request to a URL like `}<inlineCode parentName=\"p\">{`[base]/api/v1/Patient?favorite-color:exact=pink`}</inlineCode>{`.`}</p>\n    <p>{`For more information on search parameters, see the `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.hl7.org/fhir/R4/searchparameter.html\"\n      }}>{`HL7 FHIR specification`}</a>{`.`}</p>\n    <h4>{`1.1.2 Recommendations`}</h4>\n    <p>{`When creating the SearchParameter FHIRPath expression, be sure to test both the FHIRPath expression and the search parameter.`}</p>\n    <p>{`If a search parameter expression extracts an element with a data type that is incompatible with the declared search parameter type, the server skips the value and logs a message. For choice elements, like Extension.value, its recommended to restrict the expression to values of the desired type by using the `}<inlineCode parentName=\"p\">{`as`}</inlineCode>{` function. For example, to select only Decimal values from the `}<a parentName=\"p\" {...{\n        \"href\": \"http://example.org/demical\"\n      }}>{`http://example.org/demical`}</a>{` extension, use an expressions like `}<inlineCode parentName=\"p\">{`Basic.extension.where(url='http://example.org/decimal').value.as(Decimal)`}</inlineCode>{`.`}</p>\n    <h3>{`1.2 Filtering`}</h3>\n    <p>{`The FHIR server supports the filtering of built-in search parameters. The default behavior of the FHIR server is to consider all built-in search parameters when storing resources or processing search requests, but you can configure inclusion filters to restrict the FHIR server’s view to specific search parameters on a given resource type. This filtering feature does not apply to user-defined search parameters in the extension-search-parameters.json file. User-defined search parameters are always included in the FHIR server’s view regardless of the configured inclusion filters.`}</p>\n    <p>{`Why would you want to filter built-in search parameters? The answer lies in how search parameters are used by the FHIR server. When the FHIR server processes a `}<em parentName=\"p\">{`create`}</em>{` or `}<em parentName=\"p\">{`update`}</em>{` operation, it stores the resource contents in the datastore, along with search index information that is used by the FHIR server when performing search operations. The search index information stored for a particular resource instance is driven by the search parameters defined for that resource type. Therefore if you are storing a resource whose type has a lot of built-in search parameters defined for it (e.g. `}<inlineCode parentName=\"p\">{`Patient`}</inlineCode>{`), then you could potentially be storing a lot of search index information for each resource.`}</p>\n    <p>{`For performance and scalability reasons, it might be desirable to limit the number of search parameters considered during a `}<em parentName=\"p\">{`create`}</em>{` or `}<em parentName=\"p\">{`update`}</em>{` operation for particular resource types, if those search parameters will never be used in search operations. After all, if there will be no need to use the search index information, there’s no need to store it. For example, if you know that due to the way in which a particular tenant’s applications use the FHIR REST API that those applications will never need to search Patients by birthdate, then there would be no need to store search index information for the `}<inlineCode parentName=\"p\">{`birthdate`}</inlineCode>{` attribute in `}<inlineCode parentName=\"p\">{`Patient`}</inlineCode>{` resources. Consequently, you could filter out the `}<inlineCode parentName=\"p\">{`birthdate`}</inlineCode>{` search parameter for the `}<inlineCode parentName=\"p\">{`Patient`}</inlineCode>{` resource type and not lose any needed functionality, but yet save a little bit of storage capacity in your datastore.`}</p>\n    <p>{`The search parameter filtering feature is supported through a set of inclusion rules specified via the `}<inlineCode parentName=\"p\">{`fhirServer/resources`}</inlineCode>{` property group in `}<inlineCode parentName=\"p\">{`fhir-server-config.json`}</inlineCode>{`. The search parameter inclusion rules allow you to define a set of search parameters per resource type that should be included in the FHIR server’s view of search parameters when storing resources and performing search operations. The following snippet shows the general form for specifying inclusion rules:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`\"resources\": {\n    \"open\": false,\n    \"CarePlan\": {\n        \"searchParameters\": {}\n    },\n    \"ExplanationOfBenefit\": {\n        \"searchParameters\": {\n            \"_id\": \"http://hl7.org/fhir/SearchParameter/Resource-id\",\n            \"_lastUpdated\": \"http://hl7.org/fhir/SearchParameter/Resource-lastUpdated\",\n            \"patient\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-patient\",\n            \"type\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-type\",\n            \"identifier\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-identifier\",\n            \"service-date\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-service-date\"\n        }\n    },\n    \"Patient\": {\n        \"searchParameters\": {}\n    },\n    \"RelatedPerson\": {\n        \"searchParameters\": {}\n    }\n}\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`fhirServer/resources/<resourceType>/searchParameters`}</inlineCode>{` property group is a JSON map where the key is the search parameter code that will be used to search on this parameter and the value is a canonical URL which resolves to a SearchParameter definition from the `}<inlineCode parentName=\"p\">{`fhir-registry`}</inlineCode>{` at run-time.\nOmitting this property is equivalent to supporting all search parameters in the server’s registry that apply to the given resource type.\nAn empty object, `}<inlineCode parentName=\"p\">{`{}`}</inlineCode>{`, can be used to indicate that no global search parameters are supported.\nIt may be desirable to re-define a single search parameter code. In this case, if you do not wish to filter any other parameters for this type, a value of `}<inlineCode parentName=\"p\">{`\"*\": \"*\"`}</inlineCode>{` can be used to prevent further filtering.`}</p>\n    <p>{`Additionally, for SearchParameters defined across all resource types (i.e. SearchParameters with a base of type `}<inlineCode parentName=\"p\">{`Resource`}</inlineCode>{`), the filter can be applied at this level as well:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`\"resources\": {\n    \"open\": false,\n    \"CarePlan\": {\n        \"searchParameters\": {}\n    },\n    \"ExplanationOfBenefit\": {\n        \"searchParameters\": {\n            \"patient\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-patient\",\n            \"type\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-type\",\n            \"identifier\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-identifier\",\n            \"service-date\": \"http://hl7.org/fhir/us/carin-bb/SearchParameter/explanationofbenefit-service-date\"\n        }\n    },\n    \"Patient\": {\n        \"searchParameters\": {}\n    },\n    \"RelatedPerson\": {\n        \"searchParameters\": {}\n    },\n    \"Resource\": {\n        \"searchParameters\": {\n            \"_id\": \"http://hl7.org/fhir/SearchParameter/Resource-id\",\n            \"_lastUpdated\": \"http://hl7.org/fhir/SearchParameter/Resource-lastUpdated\"\n        }\n    }\n}\n`}</code></pre>\n    <p>{`For reference, the following is the list of codes in this category:`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`code`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_id`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_lastUpdated`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_profile`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_security`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_source`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_tag`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_content`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`_query`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`Note: `}<inlineCode parentName=\"p\">{`_content`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`_query`}</inlineCode>{` are not yet supported by the IBM FHIR Server.`}</p>\n    <p>{`The filter `}<inlineCode parentName=\"p\">{`\"*\": \"*\"`}</inlineCode>{` is not necessary to include these Resource-level parameters.`}</p>\n    <h4>{`1.2.1 Handling unexpected search parameters`}</h4>\n    <p>{`The IBM FHIR Server supports configurable handling of unknown or unsupported search parameters as defined at `}<a parentName=\"p\" {...{\n        \"href\": \"https://ibm.github.io/FHIR/Conformance#http-headers\"\n      }}>{`https://ibm.github.io/FHIR/Conformance#http-headers`}</a>{`.\nFiltered search parameters are handled exactly the same as undefined search parameters, meaning that searches which include these parameters will fail in `}<inlineCode parentName=\"p\">{`strict`}</inlineCode>{` mode.`}</p>\n    <h2>{`2 Re-index`}</h2>\n    <p>{`Reindexing is implemented as a custom operation that tells the server to read a set of resources and replace the existing search parameters with those newly extracted from the resource body.`}</p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`$reindex`}</inlineCode>{` operation can be invoked via an HTTP(s) POST to `}<inlineCode parentName=\"p\">{`[base]/$reindex`}</inlineCode>{`. By default, the operation will select 10 resources and re-extract their search parameters values based on the current configuration of the server. The operation supports the following parameters to control the behavior:\n|name|type|description|\n|----|----|-----------|\n|`}<inlineCode parentName=\"p\">{`_tstamp`}</inlineCode>{`|string|Reindex any resource not previously reindexed before this timestamp. Format as a date YYYY-MM-DD or time YYYY-MM-DDTHH:MM:DDZ.|\n|`}<inlineCode parentName=\"p\">{`_resourceCount`}</inlineCode>{`|integer|The maximum number of resources to reindex in this call. If this number is too large, the processing time might exceed the transaction timeout and fail.|`}</p>\n    <p>{`To aid the re-indexing process, the IBM FHIR Server team has introduced some new features into the fhir-bucket resource-loading tool for driving the reindex. The fhir-bucket tool uses a thread-pool to make concurrent POST requests to the IBM FHIR Server `}<inlineCode parentName=\"p\">{`$reindex`}</inlineCode>{` custom operation.`}</p>\n    <p>{`To run the reindex step, see this example (using PostgreSQL):`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`JAR=\"/path/to/fhir-bucket-4.5.0-cli.jar\"\n\njava \\\\\n  -Djava.util.logging.config.file=logging.properties \\\\\n  -jar \"\\${JAR}\" \\\\\n  --db-type postgresql \\\\\n  --fhir-properties fhir.properties \\\\\n  --tenant-name \"YOUR-TENANT-NAME\" \\\\\n  --max-concurrent-fhir-requests 200 \\\\\n  --no-scan \\\\\n  --reindex-tstamp YYYY-MM-DD \\\\\n  --reindex-resource-count 10 \\\\\n  --reindex-concurrent-requests 200\n`}</code></pre>\n    <p>{`The value of YYYY-MM-DD is a date-stamp used to indicate the date on which the resources have been reindexed. The IBM FHIR Server tracks when a resource was last reindexed and only resources with a reindex_tstamp value less than the given YYYY-MM-DD parameter will be processed. When a resource is reindexed, its reindex_tstamp is set to the given YYYY-MM-DD value indicating it has been processed. In most cases, using the current date (for example “2020-10-27”) is the best option for this value.`}</p>\n    <p>{`Reindexing is resource-intensive and can take several hours or even days to complete depending on the number of resources currently in the system and the capability of the hosting platform.`}</p>\n    <hr></hr>\n    <p>{`FHIR® is the registered trademark of HL7 and is used with the permission of HL7.`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}