version: "3.7"
networks:
  main:
    driver: bridge
    ipam:
      config:
        - subnet: 172.19.0.0/24
      driver: default
services:
    nats-node1:
        image: nats-streaming:0.17.0
        container_name: nats-node1
        volumes:
            - .:/nats
        command: --config /nats/config-1.conf
        networks:
            - main
        ports:
            - 4222:4222
    nats-node2:
        image: nats-streaming:0.17.0
        container_name: nats-node2
        volumes:
            - .:/nats
        command: --config /nats/config-2.conf
        networks:
            - main
        ports:
            - 4223:4223
    nats-node3:
        image: nats-streaming:0.17.0
        container_name: nats-node3
        volumes:
            - .:/nats
        command: --config /nats/config-3.conf
        networks:
            - main
        ports:
            - 4224:4224
    fhir-server:
        image: ibmcom/ibm-fhir-server
        container_name: fhir-server
        networks:
            - main
        ports:
            - "9080:9080"
            - "9443:9443"
        hostname: fhir
        volumes:
            - type: bind
              source: ./fhir-server-config
              target: /opt/ol/wlp/usr/servers/fhir-server/config/default
              read_only: true
